<div id="page-content">
    <h2>Create</h2>

    <template is="auto-binding" id="template-editor">
        <div horizontal layout wrap>
            <div class="card" flex>

                <div class="card-header">
                    Settings
                </div>

                <core-label horizontal layout flex>
                    <div horizontal layout flex>
                        <h4>Clef</h4>
                    </div>
                    <div horizontal layout flex>
                        <paper-dropdown-menu flex>
                            <paper-dropdown class="dropdown">
                                <core-menu selected="{{clef}}" valueattr="value" class="menu">
                                    <template repeat="{{clef in clefs}}">
                                        <paper-item value="{{clef.value}}" noink>{{clef.name}}</paper-item>
                                    </template>
                                </core-menu>
                            </paper-dropdown>
                        </paper-dropdown-menu>
                    </div>
                </core-label>

                <core-label horizontal layout flex>
                    <div horizontal layout flex>
                        <h4>Key</h4>
                    </div>
                    <div horizontal layout flex>
                        <paper-dropdown-menu flex>
                            <paper-dropdown class="dropdown">
                                <core-menu selected="{{key}}" valueattr="value" class="menu">
                                    <template repeat="{{key in keys}}">
                                        <paper-item value="{{key.name}}" noink>{{key.name}}</paper-item>
                                    </template>
                                </core-menu>
                            </paper-dropdown>
                        </paper-dropdown-menu>
                    </div>
                </core-label>

                <core-label horizontal layout flex>
                    <div horizontal layout flex>
                        <h4>Time signature</h4>
                    </div>
                    <div horizontal layout flex>
                        <paper-input value="{{time}}" label="C, C|, #/#" value="4/4" flex></paper-input>
                    </div>
                </core-label>

                <core-label horizontal layout flex>
                    <div horizontal layout flex>
                        <h4>Tuning</h4>
                    </div>
                    <div horizontal layout flex>
                        <paper-dropdown-menu flex>
                            <paper-dropdown class="dropdown">
                                <core-menu selected="{{tuning}}" valueattr="value" class="menu">
                                    <template repeat="{{tunning in tunings}}">
                                        <paper-item value="{{tunning.value}}" noink>{{tunning.name}}</paper-item>
                                    </template>
                                </core-menu>
                            </paper-dropdown>
                        </paper-dropdown-menu>
                    </div>
                </core-label>

                <core-label horizontal layout flex>
                    <div horizontal layout flex>
                        <h4>Note</h4>
                    </div>
                    <div horizontal layout flex>
                        <div horizontal layout flex>
                            <paper-input value="C" label="Note" flex id="note"></paper-input>
                            <paper-button onclick="transHigherUI()">+</paper-button>
                            <paper-button onclick="transLowerUI()">-</paper-button>
                        </div>
                    </div>
                </core-label>
            </div>

            <div class="card" flex two>
                <paper-button>
                    <a href="#" id="downloadLink">Download</a>
                </paper-button>
                <paper-button>
                    <a href="#" id="shareLink">Share</a>
                </paper-button>

                <div class="vex-tabdiv" width="800" scale="1.0" editor="true" editor_height="100"></div>
                <textarea name="sheet" id="sheet">tabstave notation=true tablature=false time={{time}} clef={{clef}} key={{key}} tuning={{tuning}}</textarea>
                <textarea name="sheetTrans" id="sheetTrans">tabstave notation=true tablature=false time=4/4 key=C notes :8 C-D-E-F-G-A-B/4</textarea>
            </div>
        </div>

        <div layout horizontal>
            <div class="card" flex>
                <div class="card-header">Keyboard</div>

                <p>
                    <textarea name="write" id="write">tabstave notation=true tablature=false time=4/4 key=C
notes </textarea>
                </p>

                <ul id="keyboard">
                    <li class="category">Notes</li>
                    <li class="note">A </li>
                    <li class="note">B </li>
                    <li class="note">C </li>
                    <li class="note">D </li>
                    <li class="note">E </li>
                    <li class="note">F </li>
                    <li class="note lastitem">G </li>

                    <li class="category">Alterations</li>
                    <li class="alteration">## </li>
                    <li class="alteration"># </li>
                    <li class="alteration">n </li>
                    <li class="alteration">b </li>
                    <li class="alteration lastitem">bb </li>

                    <li class="category">Durations</li>
                    <li class="duration">:1 </li>
                    <li class="duration">:2 </li>
                    <li class="duration">:4 </li>
                    <li class="duration">:8 </li>
                    <li class="duration">:16 </li>
                    <li class="duration">:32 </li>
                    <li class="duration">:64 </li>
                    <li class="duration lastitem">:128 </li>

                    <li class="category">Bars</li>
                    <li class="bar"> | </li>
                    <li class="bar"> =|| </li>
                    <li class="bar"> =|: </li>
                    <li class="bar"> =:| </li>
                    <li class="bar"> =:: </li>
                    <li class="bar lastitem"> =|= </li>

                    <li class="category">Numbers</li>
                    <li class="number">1</li>
                    <li class="number">2</li>
                    <li class="number">3</li>
                    <li class="number">4</li>
                    <li class="number">5</li>
                    <li class="number">6</li>
                    <li class="number">7</li>
                    <li class="number">8</li>
                    <li class="number">9</li>
                    <li class="number lastitem">0</li>

                    <li class="category">Characters</li>
                    <li class="spechar">/</li>
                    <li class="spechar lastitem">-</li>

                    <li class="category">Options</li>
                    <li class="delete">delete</li>
                    <li class="return lastitem">return</li>

                    <li class="space lastitem">&nbsp;</li>
                </ul>
            </div>
        </div>

       <paper-action-dialog backdrop layered="false" transition="core-transition-center" heading="Share" style="width: 640px;">
            <form action="#" method="post">
                <paper-input-decorator floatingLabel label="Email recipient's address">
                    <input is="core-input" type="mail" name="destinataire" id="destinataire" required>
                </paper-input-decorator>

                <paper-input-decorator floatingLabel label="Description">
                    <textarea is="core-input" name="description" id="description"></textarea>
                </paper-input-decorator>

                <div horizontal center-justified layout>
                    <button type="submit" id="share" is="paper-button-submit">
                        Share
                    </button>
                </div>
            </form>

            <paper-button affirmative autofocus>Fermer</paper-button>
        </paper-action-dialog>

        <paper-toast id="toast" text="Sheet music sent."></paper-toast>
        <paper-toast id="toastError" text="The email recipient's address is not valid."></paper-toast>

        <script src="assets/js/editor.js"></script>
        <script src="assets/js/keyboard.js"></script>
        <script src="assets/js/download-sheet.js"></script>
        <script src="assets/js/share-sheet.js"></script>

        <script>
        $(function() {
            'use strict';

            $('#sheet').on('keyup', function() {
                $('.editor').val($(this).val());
                $('.editor').trigger(jQuery.Event('keyup'));
            });

            $('.card').on('change', function() {
                $('#sheet').trigger(jQuery.Event('keyup'));
            });
        });
        </script>

        <script>
        var notes = ['a', 'a#', 'b', 'c', 'c#', 'd', 'd#', 'e', 'f', 'f#', 'g', 'g#'];

        /**
         * Tranposes a note higher on the panel settings.
         */
        function transHigherUI() {
            'use strict';

            var note = $('#note').val().toLowerCase();

            var index = $.inArray(note, notes);
            var start = note;

            var next = notes[($.inArray(start, notes) + 1) % notes.length];

            if (index !== -1) {
                note = next.toUpperCase();
                $('#note').val(note);
            } else {
                console.log('Note introuvable');
            }
        }

        /**
         * Transposes a note lower on the panel settings.
         */
        function transLowerUI() {
            'use strict';

            var note = $('#note').val().toLowerCase();

            var index = $.inArray(note, notes);
            var start = note;

            var prev = notes[($.inArray(start, notes) - 1 + notes.length) % notes.length];

            if (index !== -1) {
                note = prev.toUpperCase();
                $('#note').val(note);
            } else {
                console.log('Note introuvable');
            }
        }

        /**
         * Transposes a note higher.
         * @param  {string} note The note to transpose
         * @return {string} the note higher
         */
        function transHigher(note) {
            'use strict';

            var note = note.toLowerCase();

            var index = $.inArray(note, notes);
            var start = note;

            var next = notes[($.inArray(start, notes) + 1) % notes.length];

            if (index !== -1) {
                return next.toUpperCase();
            } else {
                return 'ERROR';
            }
        }

        /**
         * Transposes a note lower.
         * @param  {string} note The note to transpose
         * @return {string} the note lower
         */
        function transLower(note) {
            'use strict';

            var note = note.toLowerCase();

            var index = $.inArray(note, notes);
            var start = note;

            var prev = notes[($.inArray(start, notes) - 1 + notes.length) % notes.length];

            if (index !== -1) {
                return prev.toUpperCase();
            } else {
                return 'ERROR';
            }
        }

        /**
         * Replaces all notes to transpose.
         */
        $
        /*(function() {
                    'use strict';

                    var sheet1 = $('#sheetTrans').val().split('notes');
                    console.log(sheet1[1]);
                    var sheet = sheet1[1].split('');
                    var sheet2 = $('#sheetTrans').val();
                    console.log(sheet);

                    console.log(sheet.length);
                    console.log(notes.length);

                    sheet.forEach(function(note) {
                        if (note.match(/[a-g]#?b?/i)) {
                            console.log(transHigher(note));
                            sheet2.replace(note, transHigher(note));
                        }
                    });

                    console.log(sheet2);
                });*/
        </script>
    </template>
</div>
